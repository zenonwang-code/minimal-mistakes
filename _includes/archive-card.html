{% if post.header.teaser %}
  {% capture teaser %}{{ post.header.teaser }}{% endcapture %}
{% else %}
  {% assign teaser = site.teaser %}
{% endif %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

{% if post.link %}
  {% assign card_url = post.link %}
{% else %}
  {% assign card_url = post.url | relative_url %}
{% endif %}

<div class="cards__item">
  <article class="archive__card" itemscope itemtype="https://schema.org/CreativeWork"{% if post.locale %} lang="{{ post.locale }}"{% endif %}>
    {% if teaser %}
      <div class="archive__card-teaser">
        <img src="{{ teaser | relative_url }}" alt="">
      </div>
    {% endif %}
    <div class="archive__card-body">
      <p class="archive__card-meta">
        <span class="archive__card-date">{{ post.date | date: site.date_format }}</span>
        {% if post.tags %}
          <span class="archive__card-separator">•</span>
          <span class="archive__card-tags">{% for tag in post.tags limit: 3 %}<span class="archive__card-tag">{{ tag }}</span>{% endfor %}</span>
        {% endif %}
      </p>
      <h2 class="archive__card-title" itemprop="headline">
        {% if post.link %}
          <a href="{{ post.link }}">{{ title }}</a>
        {% else %}
          <a href="{{ post.url | relative_url }}" rel="permalink">{{ title }}</a>
        {% endif %}
      </h2>
      {% if post.excerpt %}<p class="archive__card-excerpt" itemprop="description">{{ post.excerpt | markdownify | strip_html | truncate: 160 }}</p>{% endif %}
      <div class="archive__card-footer">
        <a class="archive__card-link" href="{{ card_url }}" rel="permalink">閱讀全文 →</a>
      </div>
    </div>
  </article>
</div>
